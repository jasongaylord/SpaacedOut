{% capture date %}{{ post.date }}{% endcapture %}
{% capture this_year %}{{ date | date: "%Y" }}{% endcapture %}
{% unless year == this_year %}
{% assign year = this_year %}
{% unless forloop.first %}
</ul>
{% endunless %}
<h2 class="year">{{ date | date: "%Y" }}</h2>
<ul>
    {% endunless %}
    <li>
        <a href="{{ post.url }}">{{post.title}}</a>
        <div class="meta">
            {% if site.comments.enabled and site.comments.show_count == true %}
            {% include post/comments_link.html %}
            {% endif %}
        </div>
    </li>